---
title: 'A time series analysis about the crime in Puerto Rico from the year 2007 to 2014'
author: "Juan De Dios Santos"
date: "December 5, 2015"
output: html_document
---

## Overview
***
Crime Pattern Detection is one of the many applications of data mining, and it
deals with the study and analysis of crimes using data. As you might think, 
detecting a pattern, or even worse, predicting them is something that might seem 
taken from a movie. However it is a real application of data mining, and there 
are many research groups working on that.

In this report I will introduce the concept of time series analysis using the R base
package to inspect the assassination history of Puerto Rico from 2007 to 2014.

## The data
***

This report's dataset features the total amount of murders that happened in Puerto
Rico during the period 2007 - 2014. This data is divided by months and years. 

Let's take a look at it.


```{r, echo=FALSE}
pr_crime_table <- read.csv("~/Desktop/pr_crime_table.csv", row.names = 1)
print(pr_crime_table)
```

The first row of the dataset are the months, and the first column is the year.
For example, on January 2007 there were 66 registered assassinations.

Note: the `row.names = 1` instruction is needed to use the first column of the 
dataset as the name of the rows, which in this case are the years.

The data used was obtained from the _Instituto de Estadisticas de Puerto Rico_
(or Statistics Institute of Puerto Rico) website.  

## The analysis
***

Now that we have seen how the data is, let's commence the analysis and build
the time series model. The model is built using a vector of the values to analyze
(the crimes), by specifying the frequency or time interval, which in this case 
is 12 since we are using monthly data, and by setting the start date (January 2007).

The name of this model

```{r, echo=FALSE}
# Transform the table into a vector; ts should just take a vector, it performs
# the split into times by itself
ts.model <- ts(c(t(pr_crime_table)), frequency = 12, start = c(2007, 1))
```

Once the model is built, the next step is to decompose the time series. It will
be decompose into seasonal, trend and irregular components using moving averages - 
a calculation that shows the average value of a subset over a period of time.

```{r}
decomposition.ma <- decompose(ts.model)
names(decomposition.ma)
```

The previous line showed the components of this `decomposed` object. As it was
previously mentioned, our objective was to decomposed the time series into a 
seasonal, trend and irregular (named `random` in the object) component.

In the following sections I will be presenting and explaining each one of these 
components.


### The seasonal trend
***

The seasonal trend is the common trend across all seasons (months).

```{r}
plot(decomposition.ma$figure, type="b", xaxt="n", xlab="")
months.names <- months(ISOdate(2007,1:12,1))
axis(1, at=1:12, labels=months.names, las=2)
```


The previous plot is the seasonal trend of the data. It shows the trend of murders
of one year based on the seven years of data.
On the x-axis we have the months of the year, and on the y-axis the difference of 
the crimes from the average. For example, suppose that the average number of 
murders is 20, then the average during March would be 15 (20 - 15), because 
the March average is -5.

The plow shows that during the period February - April, the crimes seems to decrease
until it reaches a global minima at -13.5. Then, on the following month, May, the
average number of murders increase by 19. Thus, we have the less active month,
and the most active back to back. From April until the end of the year, the crime
activity does not vary that much. The following table shows the exact values of
the plot.

```{r}
print(decomposition.ma$figure)
```

### The trend
***

The trend decomposition is the trend of the murders across the complete dataset.

```{r}
plot(decomposition.ma$trend)
```

We can on this plot that the assassinations increases until it reaches a maximum
point during mid-2011, meaning that 2011 was the year with the most assassinations.
After that year the number decrease. The following present the total murders
per year, and they seem to keep the pattern shown in the plot. Both extremes of
the table, 2007 and 2014, have the smaller amount of crimes, while 2011 have the
most, 1136.

```{r}
apply(pr_crime_table, 1, function(x) sum(x))
```

## Decomposition plot

For the last section of the report, I will present a summary of the decomposition
using a plot that shows the the previous two figures, in addition to the original
values and the random or remainder decomposition.

```{r}
plot(decomposition.ma)
```

The first plot is the original values. If we compare it to the second one, the trend,
we can notice that it follows the same structure, a peak at mid-2011 and
smaller values at the extremes. The third plot, the seasonal decomposition, is the
same seasonal trend plot presented before, but repeated for all the years. Finally,
the random plot is the remainder decomposition. The value of each point of this
attribute is the difference between the original values from the seasonal plus trend fit.

### Closure
***

In this report, I presented the basics of a time series analysis using the base R
package, and an application of it using crime data from Puerto Rico. The results
found indicates that there is a trend of crimes that takes place during a year;
during the first three months they decrease, followed by an increase in April,
which then decreases. Moreover, the general trend of the data is that from 2008
up until 2011, the number of crimes increased at a slow pace, and after mid-2011
it decreased.